<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NoteCraft</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --bg-primary: #ffffff;
        --bg-secondary: #f5f5f7;
        --bg-sidebar: #2b2b2b;
        --text-primary: #1d1d1f;
        --text-secondary: #6e6e73;
        --text-sidebar: #f5f5f7;
        --border-color: #d2d2d7;
        --hover-bg: #e8e8ed;
        --active-bg: #007aff;
        --input-bg: #ffffff;
        --shadow: rgba(0, 0, 0, 0.1);
      }

      body.dark-theme {
        --bg-primary: #1c1c1e;
        --bg-secondary: #2c2c2e;
        --bg-sidebar: #000000;
        --text-primary: #f5f5f7;
        --text-secondary: #98989d;
        --text-sidebar: #f5f5f7;
        --border-color: #38383a;
        --hover-bg: #3a3a3c;
        --active-bg: #0a84ff;
        --input-bg: #2c2c2e;
        --shadow: rgba(0, 0, 0, 0.3);
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: var(--bg-primary);
        min-height: 100vh;
        color: var(--text-primary);
        transition: background 0.3s, color 0.3s;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
      }

      /* Auth Screen */
      .auth-screen {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
      }

      .auth-card {
        background: white;
        border-radius: 16px;
        padding: 40px;
        width: 100%;
        max-width: 400px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: slideUp 0.5s ease;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .auth-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .logo {
        font-size: 48px;
        margin-bottom: 10px;
      }

      .auth-header h1 {
        font-size: 28px;
        color: #333;
        margin-bottom: 5px;
      }

      .auth-header p {
        color: #999;
        font-size: 14px;
      }

      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 25px;
        border-bottom: 2px solid #f0f0f0;
      }

      .tab {
        flex: 1;
        padding: 12px;
        border: none;
        background: none;
        font-size: 16px;
        cursor: pointer;
        color: #999;
        border-bottom: 3px solid transparent;
        transition: all 0.3s ease;
        font-weight: 500;
      }

      .tab.active {
        color: #667eea;
        border-bottom-color: #667eea;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 500;
        font-size: 14px;
      }

      .form-group input {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #f0f0f0;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus {
        outline: none;
        border-color: #667eea;
        background: #f8f9ff;
      }

      .error-message {
        background: #fee;
        color: #c00;
        padding: 12px;
        border-radius: 8px;
        font-size: 14px;
        margin-bottom: 15px;
        display: none;
        animation: slideUp 0.3s ease;
      }

      .error-message.show {
        display: block;
      }

      .btn {
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 10px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
      }

      .btn-primary.loading {
        opacity: 0.7;
        pointer-events: none;
      }

      .btn-secondary {
        background: #f5f5f5;
        color: #333;
        border: 2px solid #e0e0e0;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .btn-secondary:hover {
        background: #f0f0f0;
      }

      .google-icon {
        width: 20px;
        height: 20px;
      }

      /* Notes Screen */
      .notes-screen {
        display: none;
        padding: 20px 0;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .notes-screen.show {
        display: block;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .header h1 {
        font-size: 28px;
        color: #333;
      }

      .header-actions {
        display: flex;
        gap: 10px;
      }

      .btn-small {
        padding: 10px 16px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-new {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-new:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
      }

      .btn-logout {
        background: #f5f5f5;
        color: #666;
      }

      .btn-logout:hover {
        background: #e8e8e8;
      }

      .notes-list {
        display: grid;
        gap: 15px;
        animation: fadeIn 0.3s ease;
      }

      .note-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }

      .note-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
      }

      .note-card h3 {
        font-size: 18px;
        color: #333;
        margin-bottom: 8px;
        line-height: 1.3;
      }

      .note-card p {
        color: #999;
        font-size: 14px;
        margin-bottom: 10px;
        line-height: 1.5;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .note-date {
        color: #bbb;
        font-size: 12px;
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }

      .empty-state .icon {
        font-size: 48px;
        margin-bottom: 15px;
        opacity: 0.3;
      }

      .empty-state h2 {
        color: #999;
        margin-bottom: 10px;
      }

      .empty-state p {
        color: #ccc;
        margin-bottom: 20px;
      }

      /* Note Detail Screen */
      .note-detail {
        display: none;
        animation: fadeIn 0.3s ease;
      }

      .note-detail.show {
        display: block;
      }

      .note-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }

      .back-btn {
        background: #f5f5f5;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        color: #666;
        transition: all 0.3s ease;
        margin-bottom: 15px;
      }

      .back-btn:hover {
        background: #e8e8e8;
      }

      .note-header-info h1 {
        font-size: 28px;
        color: #333;
        margin-bottom: 5px;
      }

      .note-header-info .timestamp {
        color: #999;
        font-size: 13px;
      }

      .note-actions {
        display: flex;
        gap: 10px;
      }

      .btn-icon {
        padding: 10px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .btn-edit {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-edit:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
      }

      .btn-delete {
        background: #ffe0e0;
        color: #c00;
      }

      .btn-delete:hover {
        background: #ffc0c0;
      }

      .note-content {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        line-height: 1.8;
        color: #555;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      /* Create/Edit Screen */
      .note-editor {
        display: none;
        animation: fadeIn 0.3s ease;
      }

      .note-editor.show {
        display: block;
      }

      .editor-form {
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }

      .editor-form input[type="text"] {
        width: 100%;
        font-size: 28px;
        font-weight: 600;
        color: #333;
        border: none;
        border-bottom: 2px solid #f0f0f0;
        padding: 15px 0;
        margin-bottom: 30px;
        transition: border-color 0.3s ease;
      }

      .editor-form input[type="text"]:focus {
        outline: none;
        border-bottom-color: #667eea;
      }

      .editor-form textarea {
        width: 100%;
        min-height: 400px;
        font-size: 16px;
        color: #555;
        border: 2px solid #f0f0f0;
        border-radius: 8px;
        padding: 20px;
        font-family: inherit;
        resize: vertical;
        transition: border-color 0.3s ease;
      }

      .editor-form textarea:focus {
        outline: none;
        border-color: #667eea;
        background: #f8f9ff;
      }

      .editor-stats {
        display: flex;
        gap: 12px;
        padding: 8px 12px;
        background: #f5f5f7;
        border-radius: 8px;
        font-size: 12px;
        color: #666;
        margin-top: 10px;
      }

      .editor-stats span {
        font-family: "SF Mono", Consolas, monospace;
      }

      .stat-divider {
        color: #ccc;
      }

      .editor-actions {
        display: flex;
        gap: 10px;
        margin-top: 12px;
        justify-content: space-between;
        align-items: center;
      }

      .save-indicator {
        font-size: 12px;
        color: #999;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .save-indicator.show {
        opacity: 1;
        color: #4a9d6f;
      }

      .editor-buttons {
        display: flex;
        gap: 10px;
      }

      .btn-cancel {
        background: #f5f5f5;
        color: #666;
      }

      .btn-cancel:hover {
        background: #e8e8e8;
      }

      .btn-save {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-save:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
      }

      .delete-btn-editor {
        background: #ffe0e0;
        color: #c00;
      }

      .delete-btn-editor:hover {
        background: #ffc0c0;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal.show {
        display: flex;
        animation: fadeIn 0.3s ease;
      }

      .modal-content {
        background: white;
        border-radius: 12px;
        padding: 30px;
        max-width: 400px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: slideUp 0.3s ease;
      }

      .modal-content h2 {
        font-size: 20px;
        margin-bottom: 15px;
        color: #333;
      }

      .modal-content p {
        color: #999;
        margin-bottom: 25px;
        line-height: 1.5;
      }

      .modal-actions {
        display: flex;
        gap: 10px;
      }

      .modal-actions button {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .modal-actions .btn-cancel {
        background: #f5f5f5;
        color: #666;
      }

      .modal-actions .btn-confirm {
        background: #c00;
        color: white;
      }

      .modal-actions .btn-confirm:hover {
        background: #a00;
      }

      /* Responsive - Tablet */
      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        .header {
          flex-direction: column;
          gap: 15px;
          align-items: stretch;
        }

        .header h1 {
          font-size: 24px;
        }

        .header-actions {
          display: flex;
          gap: 10px;
        }

        .btn-new,
        .btn-logout {
          flex: 1;
          text-align: center;
        }

        .note-header {
          flex-direction: column;
          gap: 15px;
        }

        .note-actions {
          width: 100%;
          display: flex;
        }

        .btn-edit,
        .btn-delete {
          flex: 1;
        }

        .editor-form textarea {
          min-height: 350px;
        }
      }

      /* Responsive - Mobile */
      @media (max-width: 480px) {
        .auth-card {
          padding: 25px 20px;
          margin: 10px;
          border-radius: 12px;
        }

        .logo {
          font-size: 40px;
        }

        .auth-header h1 {
          font-size: 24px;
        }

        .tabs {
          gap: 5px;
        }

        .tab {
          padding: 10px 5px;
          font-size: 14px;
        }

        .form-group input {
          padding: 10px 12px;
          font-size: 16px; /* Prevents zoom on iOS */
        }

        .btn {
          padding: 14px;
          font-size: 16px;
        }

        .header h1 {
          font-size: 20px;
        }

        .note-card {
          padding: 15px;
        }

        .note-card h3 {
          font-size: 16px;
        }

        .note-card p {
          font-size: 13px;
        }

        .note-header-info h1 {
          font-size: 20px;
        }

        .note-content {
          padding: 20px;
          font-size: 15px;
        }

        .editor-form {
          padding: 15px;
        }

        .editor-form input[type="text"] {
          font-size: 20px;
          padding: 10px 0;
        }

        .editor-form textarea {
          min-height: 280px;
          padding: 15px;
          font-size: 16px; /* Prevents zoom on iOS */
        }

        .editor-stats {
          justify-content: center;
          font-size: 11px;
          gap: 8px;
          padding: 6px 10px;
        }

        .editor-actions {
          flex-direction: column-reverse;
          gap: 15px;
        }

        .editor-buttons {
          width: 100%;
          display: flex;
          gap: 10px;
        }

        .editor-buttons button {
          flex: 1;
          padding: 12px;
        }

        .save-indicator {
          text-align: center;
          width: 100%;
        }

        .modal-content {
          margin: 15px;
          padding: 25px;
        }

        .modal-content h2 {
          font-size: 18px;
        }

        .modal-actions {
          flex-direction: column;
          gap: 10px;
        }

        .modal-actions button {
          width: 100%;
        }

        .toast-container {
          left: 15px;
          right: 15px;
          bottom: 15px;
        }

        .toast {
          max-width: none;
        }

        .back-btn {
          padding: 10px 14px;
        }

        .empty-state {
          padding: 40px 20px;
        }

        .empty-state .icon {
          font-size: 40px;
        }

        .empty-state h2 {
          font-size: 18px;
        }
      }

      /* Loading state */
      .loading {
        opacity: 0.7;
        pointer-events: none;
      }

      /* Toast Notifications */
      .toast-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 2000;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .toast {
        padding: 14px 20px;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        font-size: 14px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
        max-width: 300px;
      }

      .toast.success {
        background: linear-gradient(135deg, #4a9d6f 0%, #2d7a4d 100%);
      }

      .toast.error {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      }

      .toast.info {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(100px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      /* Loading Spinner */
      .spinner {
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 0.8s ease-in-out infinite;
        display: inline-block;
        margin-right: 8px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .btn.loading .spinner {
        display: inline-block;
      }

      .btn .spinner {
        display: none;
      }

      /* Tooltip */
      .tooltip {
        position: absolute;
        background: #333;
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 12px;
        bottom: -35px;
        left: 50%;
        transform: translateX(-50%);
        white-space: nowrap;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <!-- Auth Screen -->
    <div id="authScreen" class="auth-screen">
      <div class="auth-card">
        <div class="auth-header">
          <div class="logo">üîí</div>
          <h1>Notes Vault</h1>
          <p>Your private notes, secured</p>
        </div>

        <div class="error-message" id="authError"></div>

        <div class="tabs">
          <button class="tab active" data-tab="login">Login</button>
          <button class="tab" data-tab="signup">Sign Up</button>
        </div>

        <form id="loginForm" class="auth-form">
          <div class="form-group">
            <label for="loginEmail">Email</label>
            <input
              type="email"
              id="loginEmail"
              placeholder="you@example.com"
              required
            />
          </div>
          <div class="form-group">
            <label for="loginPassword">Password</label>
            <input
              type="password"
              id="loginPassword"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              required
            />
          </div>
          <button type="submit" class="btn btn-primary">Login</button>
        </form>

        <form id="signupForm" class="auth-form" style="display: none">
          <div class="form-group">
            <label for="signupEmail">Email</label>
            <input
              type="email"
              id="signupEmail"
              placeholder="you@example.com"
              required
            />
          </div>
          <div class="form-group">
            <label for="signupPassword">Password</label>
            <input
              type="password"
              id="signupPassword"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              minlength="6"
              required
            />
          </div>
          <button type="submit" class="btn btn-primary">Sign Up</button>
        </form>

        <div style="margin-top: 20px; text-align: center">
          <div style="display: flex; align-items: center; margin-bottom: 15px">
            <div style="flex: 1; height: 1px; background: #e0e0e0"></div>
            <span style="padding: 0 15px; color: #999; font-size: 14px"
              >or</span
            >
            <div style="flex: 1; height: 1px; background: #e0e0e0"></div>
          </div>
          <button type="button" class="btn btn-secondary" id="googleSignInBtn">
            <svg class="google-icon" viewBox="0 0 24 24" width="20" height="20">
              <path
                fill="#4285F4"
                d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
              />
              <path
                fill="#34A853"
                d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
              />
              <path
                fill="#FBBC05"
                d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
              />
              <path
                fill="#EA4335"
                d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
              />
            </svg>
            Continue with Google
          </button>
        </div>
      </div>
    </div>

    <!-- Main App -->
    <div id="appContainer" style="display: none">
      <!-- Notes List -->
      <div id="notesScreen" class="notes-screen show">
        <div class="container">
          <div class="header">
            <h1>My Notes</h1>
            <div class="header-actions">
              <button class="btn-small btn-new" id="newNoteBtn">
                + New Note
              </button>
              <button class="btn-small btn-logout" id="logoutBtn">
                Logout
              </button>
            </div>
          </div>

          <div id="notesList" class="notes-list">
            <div class="empty-state">
              <div class="icon">üìù</div>
              <h2>No notes yet</h2>
              <p>Create your first note to get started</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Note Detail -->
      <div id="noteDetail" class="note-detail">
        <div class="container">
          <button class="back-btn" id="backFromDetailBtn">‚Üê Back</button>
          <div class="note-header">
            <div class="note-header-info">
              <h1 id="detailTitle"></h1>
              <div class="timestamp" id="detailTimestamp"></div>
            </div>
            <div class="note-actions">
              <button class="btn-small btn-icon btn-edit" id="editNoteBtn">
                Edit
              </button>
              <button
                class="btn-small btn-icon btn-delete"
                id="deleteDetailBtn"
              >
                Delete
              </button>
            </div>
          </div>
          <div class="note-content" id="detailContent"></div>
        </div>
      </div>

      <!-- Note Editor -->
      <div id="noteEditor" class="note-editor">
        <div class="container">
          <button class="back-btn" id="backFromEditorBtn">‚Üê Back</button>
          <form class="editor-form" id="noteForm">
            <input
              type="text"
              id="noteTitle"
              placeholder="Note title..."
              required
              maxlength="200"
            />
            <textarea
              id="noteContent"
              placeholder="Start typing... Your notes are automatically saved."
            ></textarea>
            <div class="editor-stats" id="editorStats">
              <span id="wordCount">Words: 0</span>
              <span class="stat-divider">|</span>
              <span id="charCount">Characters: 0</span>
              <span class="stat-divider">|</span>
              <span id="lineCount">Lines: 1</span>
            </div>
            <div class="editor-actions">
              <div class="save-indicator" id="saveIndicator">‚úì Saved</div>
              <div class="editor-buttons">
                <button
                  type="button"
                  class="btn-small btn-icon btn-cancel"
                  id="cancelEditBtn"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  class="btn-small btn-icon btn-save"
                  id="saveNoteBtn"
                >
                  Save
                </button>
                <button
                  type="button"
                  class="btn-small btn-icon delete-btn-editor"
                  id="deleteEditorBtn"
                  style="display: none"
                >
                  Delete
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
      <div class="modal-content">
        <h2>Delete Note?</h2>
        <p>
          This action cannot be undone. Are you sure you want to delete this
          note?
        </p>
        <div class="modal-actions">
          <button type="button" class="btn-cancel" id="cancelDeleteBtn">
            Cancel
          </button>
          <button type="button" class="btn-confirm" id="confirmDeleteBtn">
            Delete
          </button>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script type="module">
      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.0/+esm";

      const SUPABASE_URL = "https://yrzoxzxxnmkasisvqzld.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlyem94enh4bm1rYXNpc3ZxemxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5ODMyNDcsImV4cCI6MjA4MzU1OTI0N30.RxZ72j61ABJXxkQibggBjOCs76IaH2yZkeVktZqZqeo";

      const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      // Toast Notification Function
      function showToast(message, type = "info") {
        const container = document.getElementById("toastContainer");
        const toast = document.createElement("div");
        toast.className = `toast ${type}`;
        toast.textContent = message;
        container.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
      }

      // State
      let currentUser = null;
      let currentNoteId = null;
      let autoSaveTimeout = null;

      // DOM Elements
      const authScreen = document.getElementById("authScreen");
      const appContainer = document.getElementById("appContainer");
      const notesScreen = document.getElementById("notesScreen");
      const noteDetail = document.getElementById("noteDetail");
      const noteEditor = document.getElementById("noteEditor");
      const deleteModal = document.getElementById("deleteModal");

      const authError = document.getElementById("authError");
      const loginForm = document.getElementById("loginForm");
      const signupForm = document.getElementById("signupForm");
      const tabs = document.querySelectorAll(".tab");
      const googleSignInBtn = document.getElementById("googleSignInBtn");
      const newNoteBtn = document.getElementById("newNoteBtn");
      const logoutBtn = document.getElementById("logoutBtn");
      const notesList = document.getElementById("notesList");
      const noteTitle = document.getElementById("noteTitle");
      const noteContent = document.getElementById("noteContent");
      const saveIndicator = document.getElementById("saveIndicator");
      const saveNoteBtn = document.getElementById("saveNoteBtn");
      const cancelEditBtn = document.getElementById("cancelEditBtn");
      const deleteEditorBtn = document.getElementById("deleteEditorBtn");
      const backFromDetailBtn = document.getElementById("backFromDetailBtn");
      const backFromEditorBtn = document.getElementById("backFromEditorBtn");
      const editNoteBtn = document.getElementById("editNoteBtn");
      const deleteDetailBtn = document.getElementById("deleteDetailBtn");
      const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");
      const cancelDeleteBtn = document.getElementById("cancelDeleteBtn");

      // Auth Tab Switching
      tabs.forEach((tab) => {
        tab.addEventListener("click", (e) => {
          tabs.forEach((t) => t.classList.remove("active"));
          e.target.classList.add("active");

          const tabName = e.target.dataset.tab;
          document.getElementById("loginForm").style.display =
            tabName === "login" ? "block" : "none";
          document.getElementById("signupForm").style.display =
            tabName === "signup" ? "block" : "none";
          authError.classList.remove("show");
        });
      });

      // Login
      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        authError.classList.remove("show");
        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;

        try {
          const { error } = await supabase.auth.signInWithPassword({
            email,
            password,
          });
          if (error) throw error;
          showToast("Welcome back!", "success");
          await checkAuth();
        } catch (error) {
          showAuthError(error.message);
        }
      });

      // Signup
      signupForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        authError.classList.remove("show");
        const email = document.getElementById("signupEmail").value;
        const password = document.getElementById("signupPassword").value;

        try {
          const { error } = await supabase.auth.signUp({ email, password });
          if (error) throw error;
          showAuthError("Sign up successful! Please log in.");
          authError.classList.add("show");
          authError.style.backgroundColor = "#f0f9ff";
          authError.style.color = "#0066cc";
          loginForm.style.display = "block";
          signupForm.style.display = "none";
          tabs[0].classList.add("active");
          tabs[1].classList.remove("active");
        } catch (error) {
          showAuthError(error.message);
        }
      });

      // Google Sign In
      googleSignInBtn.addEventListener("click", async () => {
        try {
          const { error } = await supabase.auth.signInWithOAuth({
            provider: "google",
            options: {
              redirectTo: window.location.origin,
            },
          });
          if (error) throw error;
        } catch (error) {
          showAuthError("Google sign in failed: " + error.message);
        }
      });

      // Logout
      logoutBtn.addEventListener("click", async () => {
        await supabase.auth.signOut();
        currentUser = null;
        currentNoteId = null;
        showAuthScreen();
      });

      // Check Authentication Status
      async function checkAuth() {
        const {
          data: { session },
        } = await supabase.auth.getSession();
        if (session) {
          currentUser = session.user;
          showAppScreen();
          loadNotes();
        } else {
          showAuthScreen();
        }
      }

      // Show/Hide Screens
      function showAuthScreen() {
        authScreen.style.display = "flex";
        appContainer.style.display = "none";
      }

      function showAppScreen() {
        authScreen.style.display = "none";
        appContainer.style.display = "block";
        showNotesScreen();
      }

      function showNotesScreen() {
        notesScreen.classList.add("show");
        noteDetail.classList.remove("show");
        noteEditor.classList.remove("show");
      }

      function showNoteDetail(noteId) {
        currentNoteId = noteId;
        notesScreen.classList.remove("show");
        noteDetail.classList.add("show");
        noteEditor.classList.remove("show");
        loadNoteDetail(noteId);
      }

      function showNoteEditor(noteId = null) {
        currentNoteId = noteId;
        notesScreen.classList.remove("show");
        noteDetail.classList.remove("show");
        noteEditor.classList.add("show");
        deleteEditorBtn.style.display = noteId ? "block" : "none";

        if (noteId) {
          loadNoteForEdit(noteId);
        } else {
          noteTitle.value = "";
          noteContent.value = "";
          updateEditorStats();
        }

        setTimeout(() => noteTitle.focus(), 100);
      }

      // Load Notes
      async function loadNotes() {
        try {
          const { data: notes, error } = await supabase
            .from("notes")
            .select("*")
            .order("created_at", { ascending: false });

          if (error) throw error;

          if (!notes || notes.length === 0) {
            notesList.innerHTML = `
            <div class="empty-state">
              <div class="icon">üìù</div>
              <h2>No notes yet</h2>
              <p>Create your first note to get started</p>
            </div>
          `;
            return;
          }

          notesList.innerHTML = notes
            .map(
              (note) => `
          <div class="note-card" onclick="window.app.showNoteDetail('${
            note.id
          }')">
            <h3>${escapeHtml(note.title)}</h3>
            <p>${escapeHtml(note.content)}</p>
            <div class="note-date">${formatDate(note.created_at)}</div>
          </div>
        `
            )
            .join("");
        } catch (error) {
          console.error("Error loading notes:", error);
        }
      }

      async function loadNoteDetail(noteId) {
        try {
          const { data: note, error } = await supabase
            .from("notes")
            .select("*")
            .eq("id", noteId)
            .single();

          if (error) throw error;

          document.getElementById("detailTitle").textContent = note.title;
          document.getElementById("detailTimestamp").textContent = formatDate(
            note.created_at
          );
          document.getElementById("detailContent").textContent = note.content;
        } catch (error) {
          console.error("Error loading note:", error);
        }
      }

      async function loadNoteForEdit(noteId) {
        try {
          const { data: note, error } = await supabase
            .from("notes")
            .select("*")
            .eq("id", noteId)
            .single();

          if (error) throw error;

          noteTitle.value = note.title;
          noteContent.value = note.content;
          updateEditorStats();
        } catch (error) {
          console.error("Error loading note:", error);
        }
      }

      // Save Note
      async function saveNote() {
        const title = noteTitle.value.trim();
        const content = noteContent.value.trim();

        if (!title) {
          showToast("Title is required", "error");
          return;
        }

        try {
          if (currentNoteId) {
            const { error } = await supabase
              .from("notes")
              .update({ title, content, updated_at: new Date().toISOString() })
              .eq("id", currentNoteId);

            if (error) throw error;
          } else {
            const { error } = await supabase
              .from("notes")
              .insert({ title, content, user_id: currentUser.id });

            if (error) throw error;
          }

          showToast(
            currentNoteId ? "Note updated!" : "Note created!",
            "success"
          );
          loadNotes();
          showNotesScreen();
        } catch (error) {
          showToast("Error saving note: " + error.message, "error");
        }
      }

      // Auto-save
      function autoSaveNote() {
        const title = noteTitle.value.trim();
        const content = noteContent.value.trim();

        if (!title) return;

        if (autoSaveTimeout) clearTimeout(autoSaveTimeout);

        saveIndicator.classList.remove("show");

        autoSaveTimeout = setTimeout(async () => {
          try {
            if (currentNoteId) {
              await supabase
                .from("notes")
                .update({
                  title,
                  content,
                  updated_at: new Date().toISOString(),
                })
                .eq("id", currentNoteId);
            }
            saveIndicator.classList.add("show");
            setTimeout(() => saveIndicator.classList.remove("show"), 2000);
          } catch (error) {
            console.error("Auto-save error:", error);
          }
        }, 2000);
      }

      // Delete Note
      async function deleteNote() {
        try {
          const { error } = await supabase
            .from("notes")
            .delete()
            .eq("id", currentNoteId);

          if (error) throw error;

          showToast("Note deleted", "success");
          loadNotes();
          showNotesScreen();
        } catch (error) {
          showToast("Error deleting note: " + error.message, "error");
        }
      }

      // Delete Modal
      deleteDetailBtn.addEventListener("click", () => {
        deleteModal.classList.add("show");
      });

      deleteEditorBtn.addEventListener("click", () => {
        deleteModal.classList.add("show");
      });

      cancelDeleteBtn.addEventListener("click", () => {
        deleteModal.classList.remove("show");
      });

      confirmDeleteBtn.addEventListener("click", () => {
        deleteModal.classList.remove("show");
        deleteNote();
      });

      // Event Listeners
      newNoteBtn.addEventListener("click", () => showNoteEditor());
      backFromDetailBtn.addEventListener("click", showNotesScreen);
      backFromEditorBtn.addEventListener("click", showNotesScreen);
      editNoteBtn.addEventListener("click", () =>
        showNoteEditor(currentNoteId)
      );
      cancelEditBtn.addEventListener("click", showNotesScreen);
      saveNoteBtn.addEventListener("click", (e) => {
        e.preventDefault();
        saveNote();
      });

      noteContent.addEventListener("input", () => {
        autoSaveNote();
        updateEditorStats();
      });

      // Update editor stats (word, character, line count)
      function updateEditorStats() {
        const content = noteContent.value;

        // Character count
        const chars = content.length;
        document.getElementById(
          "charCount"
        ).textContent = `Characters: ${chars.toLocaleString()}`;

        // Word count (split by whitespace, filter empty)
        const words =
          content.trim() === "" ? 0 : content.trim().split(/\s+/).length;
        document.getElementById(
          "wordCount"
        ).textContent = `Words: ${words.toLocaleString()}`;

        // Line count
        const lines = content === "" ? 1 : content.split("\n").length;
        document.getElementById(
          "lineCount"
        ).textContent = `Lines: ${lines.toLocaleString()}`;
      }

      // Utility Functions
      function showAuthError(message) {
        authError.textContent = message;
        authError.classList.add("show");
      }

      function formatDate(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffMs = now - date;
        const diffSec = Math.floor(diffMs / 1000);
        const diffMin = Math.floor(diffSec / 60);
        const diffHour = Math.floor(diffMin / 60);
        const diffDay = Math.floor(diffHour / 24);

        if (diffSec < 60) {
          return "Just now";
        } else if (diffMin < 60) {
          return `${diffMin} minute${diffMin > 1 ? "s" : ""} ago`;
        } else if (diffHour < 24) {
          return `${diffHour} hour${diffHour > 1 ? "s" : ""} ago`;
        } else if (diffDay === 1) {
          return (
            "Yesterday at " +
            date.toLocaleTimeString("en-US", {
              hour: "numeric",
              minute: "2-digit",
            })
          );
        } else if (diffDay < 7) {
          return `${diffDay} days ago`;
        } else {
          return date.toLocaleDateString("en-US", {
            month: "short",
            day: "numeric",
            year: "numeric",
          });
        }
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Initialize
      window.app = { showNoteDetail, showNoteEditor, showNotesScreen };
      checkAuth();
    </script>
  </body>
</html>
